<!DOCTYPE html>
<html>

<head>
</head>

<body>

    <!-- <script src="map.js"></script> -->
    <div class="container col-md-13 offset-md-3">
        <div class="col-6 restaurant_form">
            <div class="form-group">
                <input type="text" class="form-control" id="username" placeholder="username" required/></br>
            </div>
            <div class="form-group">
                <input type="password" class="form-control" id="password" placeholder="password" required/></br>
            </div>
            <div class="form-group">
                <input type="text" class="form-control" id="email" placeholder="email" required/> </br>
            </div>
            <div class="form-group">
                Are You A Store Owner?
                <input type="checkbox" class="form-control" id="isOwner" placeholder="isOwner" onclick=isOwner() /> </br>
            </div>
            <div class="form-group" id="restaurantName">
                <input type="text" class="form-control" placeholder="Enter name of restaurant"> </br>
            </div>

            <div class="form-group">
                <input name="user_input_autocomplete_address" class="form-control" id="user_input_autocomplete_address" placeholder="Enter your restaurant address"> </br>
            </div>
            <div class="form-group" id="description">
                <input type="text" class="form-control" placeholder="Enter your restaurant description"></br>
            </div>
            <div class="form-group" id="reservationAmount">
                <input type="int" class="form-control" placeholder="How many servings?"></br>
            </div>

            <button onclick="register()" class="btn btn-primary">Register</button>
        </div>
    </div>
    <script>
        console.log('testsetst')
        document.getElementById("restaurantName").style.visibility = "hidden"
        document.getElementById("user_input_autocomplete_address").style.visibility = "hidden"
        document.getElementById("description").style.visibility = "hidden"
        document.getElementById("reservationAmount").style.visibility = "hidden"

        function isOwner() {
            // document.getElementById("username").style.visibility=""
            console.log('sahsflkjashflkshflkasjhflsdkfjhadslkfhasdlkhadsflkjasfhlkasfjhlkashsaklhfsap-ihsadfpkjsadfhp')
            if (!document.getElementById("isOwner").checked) {
                document.getElementById("restaurantName").style.visibility = "hidden"
                document.getElementById("user_input_autocomplete_address").style.visibility = "hidden"
                document.getElementById("description").style.visibility = "hidden"
                document.getElementById("reservationAmount").style.visibility = "hidden"
            } else {
                document.getElementById("restaurantName").style.visibility = "visible"
                document.getElementById("user_input_autocomplete_address").style.visibility = "visible"
                document.getElementById("description").style.visibility = "visible"
                document.getElementById("reservationAmount").style.visibility = "visible"
            }
        }


        function register() {
            if (document.getElementById('isOwner').checked) {
				//if it's owner, then this will go to this function
                registerAddress()
            } else {
                //preparing to send information over to the backend by organizing data into a data structure
                var dict = {
                    'username': document.getElementById("username").value,
                    'password': document.getElementById('password').value,
                    'email': document.getElementById('email').value,
                    'isOwner': false,
                    'latitude': null,
                    'longitude': null,
                    'description': null,
                    'address': null,
                    'reservationAmount': null,
                    'restaurantName': null
                };
                //this will post into flask, and because we posted through this method
                //the backend will no longer be able to redirect pages 
                //the fix around is to have the backend send back a message to the frontend
                //to let it know that it's time to switch pages
                $.post("/registerAuth", dict, function(response) {
                    if (response == "success") {
                        window.location.href = "/";
                    } else {
                        alert("User already exists")
                    }
                })
            }
        }

        //the script runs here since registeraddress is not found if created on a different file
        function registerAddress() {
            address = document.getElementById("user_input_autocomplete_address").value;
            const geocoder = new google.maps.Geocoder();
            geocoder.geocode({
                address: address
            }, (results, status) => {
                if (status === google.maps.GeocoderStatus.OK) {
                    var lat = results[0].geometry.location.lat();
                    var lng = results[0].geometry.location.lng();
                    // Display Longitude and Latitude
                    console.log("LAT: ", lat)
                    console.log("LAT: ", lng)

                    //preparing to send information over to the backend by organizing data into a data structure
                    var dict = {
                        'username': document.getElementById("username").value,
                        'password': document.getElementById('password').value,
                        'email': document.getElementById('email').value,
                        'isOwner': true,
                        'latitude': lat,
                        'longitude': lng,
                        'description': document.getElementById("description").value,
                        'address': address,
                        'reservationAmount': document.getElementById("reservationAmount").value,
                        'restaurantName': document.getElementById("restaurantName").value
                    };
                    //this will post into flask, and because we posted through this method
                    //the backend will no longer be able to redirect pages 
                    //the fix around is to have the backend send back a message to the frontend
                    //to let it know that it's time to switch pages
                    $.post("/registerAuth", dict, function(response) {
                        if (response == "success") {
                            window.location.href = "/";
                        } else {
                            alert("User already exists")
                        }
                    })
                } else {
                    alert("Geocode was not successful for the following reason" + status);
                }
            });
        }
    </script>
    {% if error %}
    <p class="error"><strong>Error:</strong> {{error}}</p>
    {% endif %}

    <a href="/">Go back</a>

</body>


</html>

<!-- 
<script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyConR294pViXPOrz4QX2vP9e3hZsZNX1X0&libraries=places">
</script>
-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- Include Google Maps JS API  -->
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyConR294pViXPOrz4QX2vP9e3hZsZNX1X0&libraries=places"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="style.css">
<!-- Custom JS code to bind to Autocomplete API -->
<script type="text/javascript" src="autocomplete.js"></script>